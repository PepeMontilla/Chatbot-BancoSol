<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Banco Sol â€” Mi Cuenta</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:ital,opsz,wght@0,18..144,300..900;1,18..144,300..900&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --brand: #E56A00;
            --brand-600: #D35400;
            --brand-700: #C34B00;
            --brand-300: #FFA55E;
            --bg: #f5f7fb;
            --bg-2: #eef2f9;
            --card: #ffffff;
            --text: #1b1d22;
            --muted: #6b7280;
            --ring: 0 0 0 3px rgba(229, 106, 0, .18);
            --shadow-lg: 0 15px 40px rgba(31, 41, 55, .15);
            --shadow-md: 0 8px 24px rgba(31, 41, 55, .10);
            --radius: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        html,
        body {
            height: 100%
        }

        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans";
            background:
                radial-gradient(1200px 600px at 80% -10%, rgba(255, 170, 92, .12), transparent 60%),
                radial-gradient(800px 400px at -10% 100%, rgba(255, 140, 66, .10), transparent 60%),
                linear-gradient(180deg, var(--bg), var(--bg-2));
            color: var(--text);
            min-height: 100vh;
        }

        h1,
        h2,
        h3,
        .title {
            font-family: "Merriweather", serif;
            font-weight: 900;
            letter-spacing: 0.3px;
            font-size: 20px;
        }

        /* --- Navbar --- */
        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 24px;
            background: linear-gradient(180deg, var(--brand), var(--brand-700));
            color: #fff;
            box-shadow: 0 6px 14px rgba(229, 106, 0, .25);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .navbar .brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .navbar .logo {
            width: 34px;
            height: 34px;
            display: grid;
            place-items: center;
            border-radius: 999px;
            background: rgba(255, 255, 255, .18);
            font-size: 18px;
        }

        .navbar h1 {
            font-size: 1.15rem;
            margin: 0;
            color: #fff;
        }

        .navbar .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: .95rem;
            font-weight: 500;
        }

        .navbar .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 999px;
            background: rgba(255, 255, 255, .2);
            display: grid;
            place-items: center;
            font-weight: 700;
            font-size: .95rem;
        }

        .btn-logout {
            background: rgba(255, 255, 255, .15);
            border: 1px solid rgba(255, 255, 255, .25);
            color: #fff;
            padding: 8px 16px;
            border-radius: 10px;
            font-weight: 600;
            font-size: .85rem;
            cursor: pointer;
            text-decoration: none;
            transition: background .2s ease;
        }

        .btn-logout:hover {
            background: rgba(255, 255, 255, .25);
        }

        /* --- Main Content --- */
        .main-content {
            max-width: 900px;
            margin: 0 auto;
            padding: 32px 20px 100px;
        }

        .greeting {
            margin-bottom: 28px;
        }

        .greeting h2 {
            font-size: 1.6rem;
            color: var(--text);
            margin-bottom: 4px;
        }

        .greeting p {
            color: var(--muted);
            font-size: .95rem;
        }

        /* --- Balance Card --- */
        .balance-card {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(17, 24, 39, .06);
            padding: 28px 32px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--brand), var(--brand-300));
        }

        .balance-label {
            font-size: .9rem;
            color: var(--muted);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .balance-amount {
            font-family: "Poppins", sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--text);
            letter-spacing: -1px;
        }

        .balance-currency {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--muted);
            margin-left: 4px;
        }

        .balance-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
            padding: 6px 14px;
            border-radius: 999px;
            background: #fff7ed;
            color: var(--brand-600);
            font-size: .85rem;
            font-weight: 600;
        }

        /* --- Quick Actions --- */
        .section-title {
            font-size: 1.05rem;
            color: var(--text);
            margin-bottom: 16px;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 14px;
            margin-bottom: 28px;
        }

        .action-card {
            background: var(--card);
            border-radius: 14px;
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(17, 24, 39, .06);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: transform .12s ease, box-shadow .2s ease;
            text-decoration: none;
            color: var(--text);
        }

        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .action-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: grid;
            place-items: center;
            font-size: 22px;
            background: #fff7ed;
            color: var(--brand);
        }

        .action-card span {
            font-weight: 600;
            font-size: .9rem;
            text-align: center;
        }

        /* --- Recent Activity --- */
        .activity-card {
            background: var(--card);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            border: 1px solid rgba(17, 24, 39, .06);
            padding: 24px;
        }

        .empty-state {
            text-align: center;
            padding: 32px 16px;
            color: var(--muted);
        }

        .empty-state .empty-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            opacity: .5;
        }

        .empty-state p {
            font-size: .95rem;
            line-height: 1.5;
        }

        /* --- Chat flotante (mismo del login) --- */
        .fab-btn {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 999px;
            background: linear-gradient(135deg, var(--brand-300), var(--brand));
            color: #fff;
            font-size: 26px;
            display: grid;
            place-items: center;
            box-shadow: 0 12px 26px rgba(229, 106, 0, .35);
            cursor: pointer;
            transition: transform .15s ease, filter .2s ease;
            z-index: 1000;
        }

        .fab-btn:hover {
            filter: brightness(1.07)
        }

        .fab-btn:active {
            transform: translateY(1px)
        }

        .chat-widget {
            position: fixed;
            right: 22px;
            bottom: 96px;
            width: 340px;
            max-width: 92vw;
            height: 460px;
            background: #ffffff;
            color: #111827;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            display: grid;
            grid-template-rows: auto 1fr auto;
            transform-origin: bottom right;
            transform: scale(.98) translateY(8px);
            opacity: 0;
            pointer-events: none;
            transition: transform .22s ease, opacity .22s ease;
            overflow: hidden;
            z-index: 1000;
        }

        .chat-widget.open {
            transform: scale(1) translateY(0);
            opacity: 1;
            pointer-events: auto;
        }

        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
            padding: 12px 14px;
            background: linear-gradient(180deg, var(--brand), var(--brand-700));
            color: #fff;
            font-weight: 600;
        }

        .chat-header .title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chat-header .avatar {
            width: 26px;
            height: 26px;
            border-radius: 999px;
            display: grid;
            place-items: center;
            background: rgba(255, 255, 255, .18);
        }

        .close-chat {
            cursor: pointer;
            opacity: .95;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: grid;
            place-items: center;
            background: transparent;
            border: none;
            padding: 0;
            line-height: 0;
            transition: transform .08s ease, opacity .08s ease;
            color: rgba(0, 0, 0, 0.95);
        }

        .close-chat:hover {
            transform: translateY(-1px)
        }

        .close-chat:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 84, 0, .12);
            border-radius: 8px;
        }

        .chat-body {
            background: #f8fafc;
            padding: 12px;
            overflow: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: .95rem;
        }

        .msg-sol {
            align-self: flex-start;
            max-width: 80%;
            background: #eef2f7;
            color: #111827;
            padding: 10px 12px;
            border-radius: 14px 14px 14px 4px;
        }

        .msg-user {
            align-self: flex-end;
            max-width: 80%;
            background: linear-gradient(135deg, var(--brand-300), var(--brand));
            color: white;
            padding: 10px 12px;
            border-radius: 14px 14px 4px 14px;
        }

        .typing {
            opacity: .75;
            font-size: .9rem
        }

        .chat-footer {
            display: flex;
            gap: 8px;
            padding: 10px;
            border-top: 1px solid #e5e7eb;
            background: #ffffff;
        }

        .chat-input {
            flex: 1;
            border: none;
            border-radius: 999px;
            padding: 10px 14px;
            background: #f3f4f6;
            color: #111827;
        }

        .send-btn {
            border: none;
            background: transparent;
            font-size: 1.2rem;
            cursor: pointer;
        }

        /* ====== MODO OSCURO ====== */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f0f10;
                --bg-2: #16171a;
                --card: #1c1d20;
                --text: #f3f4f6;
                --muted: #9aa0a6;
            }

            body {
                background:
                    radial-gradient(1200px 600px at 80% -10%, rgba(255, 170, 92, .20), transparent 60%),
                    radial-gradient(800px 400px at -10% 100%, rgba(255, 140, 66, .18), transparent 60%),
                    linear-gradient(180deg, var(--bg), var(--bg-2));
                color: var(--text);
            }

            .balance-card,
            .action-card,
            .activity-card {
                background: var(--card);
                border-color: rgba(255, 255, 255, .06);
            }

            .balance-card::before {
                background: linear-gradient(90deg, var(--brand), var(--brand-300));
            }

            .balance-status {
                background: #2a1a10;
                color: #ffcfad;
            }

            .action-icon {
                background: #2a1a10;
                color: var(--brand-300);
            }

            .chat-widget {
                background: #1c1d20;
                color: #f3f4f6;
                border-color: rgba(255, 255, 255, .08);
            }

            .chat-body {
                background: #1f2025;
            }

            .msg-sol {
                background: #2a2c31;
                color: #f3f4f6;
            }

            .chat-footer {
                background: #1c1d20;
                border-color: rgba(255, 255, 255, .10);
            }

            .chat-input {
                background: #2a2c31;
                color: #f3f4f6;
            }
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="brand">
            <div class="logo">&#9728;&#65039;</div>
            <h1>Banco Sol</h1>
        </div>
        <div class="user-info">
            <div class="user-avatar">{{ nombre[0]|upper }}</div>
            <span>{{ nombre }}</span>
            <a href="/" class="btn-logout">Cerrar Sesion</a>
        </div>
    </nav>

    <!-- Main -->
    <main class="main-content">
        <!-- Saludo -->
        <div class="greeting">
            <h2>Hola, {{ nombre }}</h2>
            <p>Bienvenido a tu banca en linea.</p>
        </div>

        <!-- Tarjeta de Saldo -->
        <div class="balance-card">
            <div class="balance-label">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2" />
                    <line x1="1" y1="10" x2="23" y2="10" />
                </svg>
                Saldo disponible
            </div>
            <div>
                <span class="balance-amount">$0.00</span>
                <span class="balance-currency">USD</span>
            </div>
            <div class="balance-status">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10" />
                    <line x1="12" y1="8" x2="12" y2="12" />
                    <line x1="12" y1="16" x2="12.01" y2="16" />
                </svg>
                Cuenta nueva - Sin movimientos
            </div>
        </div>

        <!-- Acciones Rapidas -->
        <h3 class="section-title">Acciones rapidas</h3>
        <div class="actions-grid">
            <div class="action-card" onclick="alert('Funcion proximamente disponible')">
                <div class="action-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="1" x2="12" y2="23" />
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                    </svg>
                </div>
                <span>Transferir</span>
            </div>
            <div class="action-card" onclick="alert('Funcion proximamente disponible')">
                <div class="action-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="7 10 12 15 17 10" />
                        <line x1="12" y1="15" x2="12" y2="3" />
                    </svg>
                </div>
                <span>Depositar</span>
            </div>
            <div class="action-card" onclick="alert('Funcion proximamente disponible')">
                <div class="action-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="5" width="20" height="14" rx="2" />
                        <line x1="2" y1="10" x2="22" y2="10" />
                    </svg>
                </div>
                <span>Mis Tarjetas</span>
            </div>
            <div class="action-card" onclick="alert('Funcion proximamente disponible')">
                <div class="action-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <polyline points="12 6 12 12 16 14" />
                    </svg>
                </div>
                <span>Historial</span>
            </div>
        </div>

        <!-- Actividad Reciente -->
        <h3 class="section-title">Actividad reciente</h3>
        <div class="activity-card">
            <div class="empty-state">
                <div class="empty-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" style="opacity:.4">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <polyline points="10 9 9 9 8 9" />
                    </svg>
                </div>
                <p>No tienes movimientos aun.<br>Cuando realices tu primera transaccion, aparecera aqui.</p>
            </div>
        </div>
    </main>

    <!-- Boton flotante -->
    <button class="fab-btn" id="fab" aria-label="Abrir chat de soporte" onclick="toggleChat()">&#9728;&#65039;</button>

    <!-- Chat flotante -->
    <section class="chat-widget" id="chatWidget" role="dialog" aria-labelledby="chatTitle" aria-modal="false">
        <header class="chat-header">
            <div class="title">
                <div class="avatar">&#9728;&#65039;</div><span id="chatTitle">Soporte Sol</span>
            </div>
            <button class="close-chat" onclick="toggleChat()" aria-label="Cerrar chat">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
                    aria-hidden="true">
                    <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                    <path d="M6 18L18 6" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </button>
        </header>

        <div class="chat-body" id="chatBody">
            <div class="msg-sol">Hola <b>{{ nombre }}</b>. Soy Sol, tu asistente. Escribe "Menu" para ver las opciones
                disponibles.</div>
        </div>

        <footer class="chat-footer">
            <input id="chatInput" class="chat-input" type="text" placeholder="Escribe aqui..."
                onkeypress="handleEnter(event)" />
            <button class="send-btn" onclick="sendMessage()" aria-label="Enviar">&#10148;</button>
        </footer>
    </section>

    <script>
        const widget = document.getElementById('chatWidget');
        const chatBody = document.getElementById('chatBody');
        const chatInput = document.getElementById('chatInput');

        function toggleChat() { widget.classList.toggle('open'); }
        function handleEnter(e) { if (e.key === 'Enter') sendMessage(); }

        function addSolMessage(html) {
            chatBody.insertAdjacentHTML('beforeend', '<div class="msg-sol">' + html + '</div>');
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function sendMessage() {
            var text = chatInput.value.trim();
            if (!text) return;

            chatBody.insertAdjacentHTML('beforeend', '<div class="msg-user">' + text + '</div>');
            chatInput.value = '';
            chatBody.scrollTop = chatBody.scrollHeight;

            var tempId = 'typing-' + Date.now();
            chatBody.insertAdjacentHTML('beforeend', '<div id="' + tempId + '" class="msg-sol typing">Sol esta escribiendo...</div>');
            chatBody.scrollTop = chatBody.scrollHeight;

            fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mensaje: text, usuario: '{{ nombre }}' })
            })
                .then(function (res) { return res.json(); })
                .then(function (data) {
                    var el = document.getElementById(tempId);
                    if (el) el.remove();
                    addSolMessage(data.respuesta);

                    // Si la respuesta indica cambio de clave exitoso, redirigir al login
                    var resp = data.respuesta.toLowerCase();
                    if (resp.indexOf('clave') !== -1 && (resp.indexOf('cambiada') !== -1 || resp.indexOf('actualizada') !== -1 || resp.indexOf('modificada') !== -1 || resp.indexOf('exitosamente') !== -1 || resp.indexOf('con exito') !== -1 || resp.indexOf('correctamente') !== -1)) {
                        setTimeout(function () {
                            window.location.href = '/';
                        }, 1500);
                    }
                })
                .catch(function () {
                    var el = document.getElementById(tempId);
                    if (el) el.remove();
                    addSolMessage('Lo siento, hubo un problema de conexion. Intentalo de nuevo.');
                });
        }
    </script>
</body>

</html>